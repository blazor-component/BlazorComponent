{"version":3,"file":"input.js","sources":["../../../BlazorComponent.Web3/src/events/EventType.ts","../../../BlazorComponent.Web3/src/input.ts"],"sourcesContent":["// see https://github.com/dotnet/aspnetcore/blob/main/src/Components/Web.JS/src/Rendering/Events/EventTypes.ts\r\n// updated at 2022/08/31\r\n\r\nexport function parseMouseEvent(event: MouseEvent): Blazor.MouseEventArgs {\r\n  return {\r\n    detail: event.detail,\r\n    screenX: event.screenX,\r\n    screenY: event.screenY,\r\n    clientX: event.clientX,\r\n    clientY: event.clientY,\r\n    offsetX: event.offsetX,\r\n    offsetY: event.offsetY,\r\n    pageX: event.pageX,\r\n    pageY: event.pageY,\r\n    button: event.button,\r\n    buttons: event.buttons,\r\n    ctrlKey: event.ctrlKey,\r\n    shiftKey: event.shiftKey,\r\n    altKey: event.altKey,\r\n    metaKey: event.metaKey,\r\n    type: event.type,\r\n  } as Blazor.MouseEventArgs;\r\n}\r\n\r\nexport function parseTouchEvent(event: TouchEvent): Blazor.TouchEventArgs {\r\n  return {\r\n    detail: event.detail,\r\n    touches: parseTouch(event.touches),\r\n    targetTouches: parseTouch(event.targetTouches),\r\n    changedTouches: parseTouch(event.changedTouches),\r\n    ctrlKey: event.ctrlKey,\r\n    shiftKey: event.shiftKey,\r\n    altKey: event.altKey,\r\n    metaKey: event.metaKey,\r\n    type: event.type,\r\n  };\r\n}\r\n\r\nfunction parseTouch(touchList: TouchList): Blazor.TouchPoint[] {\r\n  const touches: Blazor.TouchPoint[] = [];\r\n\r\n  for (let i = 0; i < touchList.length; i++) {\r\n    const touch = touchList[i];\r\n    touches.push({\r\n      identifier: touch.identifier,\r\n      clientX: touch.clientX,\r\n      clientY: touch.clientY,\r\n      screenX: touch.screenX,\r\n      screenY: touch.screenY,\r\n      pageX: touch.pageX,\r\n      pageY: touch.pageY,\r\n    });\r\n  }\r\n  return touches;\r\n}\r\n\r\nexport function parseChangeEvent(event: Event): Blazor.ChangeEventArgs {\r\n  const element = event.target as Element;\r\n  if (isTimeBasedInput(element)) {\r\n    const normalizedValue = normalizeTimeBasedValue(element);\r\n    return { value: normalizedValue };\r\n  } else if (isMultipleSelectInput(element)) {\r\n    const selectElement = element as HTMLSelectElement;\r\n    const selectedValues = Array.from(selectElement.options)\r\n      .filter((option) => option.selected)\r\n      .map((option) => option.value);\r\n    return { value: selectedValues };\r\n  } else {\r\n    const targetIsCheckbox = isCheckbox(element);\r\n    const newValue = targetIsCheckbox ? !!element[\"checked\"] : element[\"value\"];\r\n    return { value: newValue };\r\n  }\r\n}\r\n\r\nfunction isTimeBasedInput(element: Element): element is HTMLInputElement {\r\n  return timeBasedInputs.indexOf(element.getAttribute(\"type\")!) !== -1;\r\n}\r\n\r\nconst timeBasedInputs = [\"date\", \"datetime-local\", \"month\", \"time\", \"week\"];\r\n\r\nfunction normalizeTimeBasedValue(element: HTMLInputElement): string {\r\n  const value = element.value;\r\n  const type = element.type;\r\n  switch (type) {\r\n    case \"date\":\r\n    case \"month\":\r\n      return value;\r\n    case \"datetime-local\":\r\n      return value.length === 16 ? value + \":00\" : value; // Convert yyyy-MM-ddTHH:mm to yyyy-MM-ddTHH:mm:00\r\n    case \"time\":\r\n      return value.length === 5 ? value + \":00\" : value; // Convert hh:mm to hh:mm:00\r\n    case \"week\":\r\n      // For now we are not going to normalize input type week as it is not trivial\r\n      return value;\r\n  }\r\n\r\n  throw new Error(`Invalid element type '${type}'.`);\r\n}\r\n\r\nfunction isMultipleSelectInput(element: Element): element is HTMLSelectElement {\r\n  return (\r\n    element instanceof HTMLSelectElement && element.type === \"select-multiple\"\r\n  );\r\n}\r\n\r\nfunction isCheckbox(element: Element | null): boolean {\r\n  return (\r\n    !!element &&\r\n    element.tagName === \"INPUT\" &&\r\n    element.getAttribute(\"type\") === \"checkbox\"\r\n  );\r\n}\r\n","import { parseChangeEvent } from \"./events/EventType\";\n\nfunction registerInputEvents(\n  element: Element,\n  dotNet: DotNet.DotNetObject,\n  debounce: number\n) {\n  if (!element) return;\n\n  let compositionInputting = false;\n  let listener;\n\n  if (debounce > 0) {\n    let timeout;\n    listener = function (args: any) {\n      if (compositionInputting) return;\n\n      clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        console.log(\"invoke debounce ~~~\");\n\n        var changeEventArgs = parseChangeEvent(args);\n        dotNet.invokeMethodAsync(\"Invoke\", changeEventArgs);\n      }, debounce);\n    };\n  } else {\n    listener = function (args: any) {\n      if (compositionInputting) return;\n\n      console.log(\"invoke ~~~\");\n\n      var changeEventArgs = parseChangeEvent(args);\n      dotNet.invokeMethodAsync(\"Invoke\", changeEventArgs);\n    };\n  }\n\n  element.addEventListener(\n    \"compositionstart\",\n    (_) => (compositionInputting = true)\n  );\n  element.addEventListener(\n    \"compositionend\",\n    (_) => (compositionInputting = false)\n  );\n  element.addEventListener(\"input\", listener);\n}\n\nexport { registerInputEvents };\n"],"names":["parseChangeEvent","event","element","target","timeBasedInputs","indexOf","getAttribute","isTimeBasedInput","normalizedValue","value","type","length","Error","normalizeTimeBasedValue","HTMLSelectElement","isMultipleSelectInput","selectElement","Array","from","options","filter","option","selected","map","targetIsCheckbox","tagName","isCheckbox","registerInputEvents","dotNet","debounce","listener","compositionInputting","timeout","args","clearTimeout","setTimeout","console","log","changeEventArgs","invokeMethodAsync","addEventListener","_"],"mappings":"AAwDM,SAAUA,EAAiBC,GAC/B,MAAMC,EAAUD,EAAME,OACtB,GAgBF,SAA0BD,GACxB,OAAmE,IAA5DE,EAAgBC,QAAQH,EAAQI,aAAa,QACtD,CAlBMC,CAAiBL,GAAU,CAC7B,MAAMM,EAqBV,SAAiCN,GAC/B,MAAMO,EAAQP,EAAQO,MAChBC,EAAOR,EAAQQ,KACrB,OAAQA,GACN,IAAK,OACL,IAAK,QAML,IAAK,OAEH,OAAOD,EANT,IAAK,iBACH,OAAwB,KAAjBA,EAAME,OAAgBF,EAAQ,MAAQA,EAC/C,IAAK,OACH,OAAwB,IAAjBA,EAAME,OAAeF,EAAQ,MAAQA,EAMhD,MAAM,IAAIG,MAAM,yBAAyBF,MAC3C,CAtC4BG,CAAwBX,GAChD,MAAO,CAAEO,MAAOD,EACjB,CAAM,GAsCT,SAA+BN,GAC7B,OACEA,aAAmBY,mBAAsC,oBAAjBZ,EAAQQ,IAEpD,CA1CaK,CAAsBb,GAAU,CACzC,MAAMc,EAAgBd,EAItB,MAAO,CAAEO,MAHcQ,MAAMC,KAAKF,EAAcG,SAC7CC,QAAQC,GAAWA,EAAOC,WAC1BC,KAAKF,GAAWA,EAAOZ,QAE3B,CAAM,CACL,MAAMe,EAqCV,SAAoBtB,GAClB,QACIA,GACkB,UAApBA,EAAQuB,SACyB,aAAjCvB,EAAQI,aAAa,OAEzB,CA3C6BoB,CAAWxB,GAEpC,MAAO,CAAEO,MADQe,IAAqBtB,EAAiB,QAAIA,EAAe,MAE3E,CACH,CAMA,MAAME,EAAkB,CAAC,OAAQ,iBAAkB,QAAS,OAAQ,QC5EpE,SAASuB,EACPzB,EACA0B,EACAC,GAEA,IAAK3B,EAAS,OAEd,IACI4B,EADAC,GAAuB,EAG3B,GAAIF,EAAW,EAAG,CAChB,IAAIG,EACJF,EAAW,SAAUG,GACfF,IAEJG,aAAaF,GACbA,EAAUG,YAAW,KACnBC,QAAQC,IAAI,uBAEZ,IAAIC,EAAkBtC,EAAiBiC,GACvCL,EAAOW,kBAAkB,SAAUD,EAAgB,GAClDT,GACL,CACD,MACCC,EAAW,SAAUG,GACnB,IAAIF,EAAJ,CAEAK,QAAQC,IAAI,cAEZ,IAAIC,EAAkBtC,EAAiBiC,GACvCL,EAAOW,kBAAkB,SAAUD,EALF,CAMnC,EAGFpC,EAAQsC,iBACN,oBACCC,GAAOV,GAAuB,IAEjC7B,EAAQsC,iBACN,kBACCC,GAAOV,GAAuB,IAEjC7B,EAAQsC,iBAAiB,QAASV,EACpC"}